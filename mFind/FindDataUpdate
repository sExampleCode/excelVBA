'찾기 수정
Sub Find_Update()

    Dim rngPICTURE As Range, rngDB As Range
    Dim strAddr As String                         '처음 검색하여 찾은 셀의 주소 넣을 변수
    Dim c As Range                                '검색하여 찾은 영역을 넣을 변수
    Dim r As Range
    Dim shp As Shape
    Dim sFilePath As String
    Dim var As Variant
    Dim FSO As FileSystemObject
    Dim f As Folder
    Dim ans As Long
    
    If Me.lstDB.ListItems.Count > 0 Then
        
        Set rngDB = Sheet3.Range("a1", Sheet3.Cells(Rows.Count, "a").End(xlUp))
        
        '입력된 데이터가 1개 이상이라면
        If rngDB.Rows.Count > 1 Then
            With rngDB              '현재시트 사용영역에서
                Set c = .Find(What:=Me.lstDB.SelectedItem, Lookat:=xlWhole) '처음 일치하는 데이터("가")를 찾아 C에 넣고
                
                If Not c Is Nothing Then                  '만일 일치하는 데이터가 있으면
                    strAddr = c.Address                   '첫 일치하는 주소를 strAddr에 넣고
                    
                    Do                                           '다음을 실행
                    
                    Set r = c
                    
                    Loop While Not c Is Nothing And c.Address <> strAddr
                    
                    '일치하는 데이터 없고 처음 일치한 주소 아닐때까지 반복
                End If
            
            End With
        End If
    End If
    
    If Not r Is Nothing Then
        Set rngDB = Sheet3.Cells(Rows.Count, "a").End(xlUp)
        
        '입력 내용을 배열 변수에 저장
        var = Array(CInt(Me.lblNo), Me.cbDivision, Me.txtPlace, CDate(Me.dtS), Me.txtErrContents, CDate(Me.dtE), Me.txtErrAS, _
                        Me.cbResult, Me.txtEtc)
        
        r.Resize(1, 9) = var
        
        With rngDB
            '열너비자동 테두리
            Call AutoFit_Border(.CurrentRegion)
        End With
        
        '입력값 초기화
        Call Init_InputValue
        
        ans = MsgBox("사진을 수정하시겠습니까?", vbYesNo + vbInformation, "수정")
        
        If ans = vbYes Then
            Set rngPICTURE = Sheet4.Range("a1:q13")
        
            '특정영역 도형삭제
            Call Del_Shps_In_Range(rngPICTURE)
            
            With Application.FileDialog(msoFileDialogFilePicker)
                .AllowMultiSelect = False
                .Title = "수정 할 이미지를 선택하세요."
                .Filters.Clear
                .Filters.Add "Images", "*.png; *.jpg; *.jpeg"
                
                If .Show = -1 Then
                    sFilePath = .SelectedItems(1)
                End If
            End With
            
            If sFilePath <> vbNullString Then
                Set FSO = New FileSystemObject
                Set f = FSO.GetFile(sFilePath)
                
                sFilePath = f.ParentFolder & "\" & f.Name
                
                r.Offset(, 9) = f.ParentFolder
                r.Offset(, 10) = f.Name
                
                Set shp = Sheet4.Shapes.AddPicture(sFilePath, msoFalse, msoTrue, rngPICTURE.Left + 2, rngPICTURE.Top + 2, rngPICTURE.Width - 4, rngPICTURE.Height - 4)
            
                
            End If
        
        End If
        
        '버튼비활성화 입력수정삭제
        Call BtnAll_UnEnable
            
        'lstDB 데이터 가져오기
        Call Get_lstDB
        
    End If
    
    Set rngPICTURE = Nothing
    Set rngDB = Nothing
    Set shp = Nothing
    Set r = Nothing
    Set c = Nothing
End Sub
